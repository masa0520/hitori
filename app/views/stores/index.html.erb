<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-lg inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">Stores</h1>
    <%= link_to 'New store', new_store_path, class: "rounded-lg py-3 px-5 bg-blue-600 text-white block font-medium" %>
  </div>

  <div id="map"></div>
  <script>
  let map

    function initMap(){
      geocoder = new google.maps.Geocoder()

      map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 35.68123620000001, lng:139.7671248},
          zoom: 5,
      });

       //複数マーカー ここから
      <% @stores.each do |store|%>
        ( function() { 
          let markerLatLng = new google.maps.LatLng({lat: <%= store.latitude %>, lng: <%= store.longitude %>}); // 緯度経度のデータ作成
          let marker = new google.maps.Marker({ 
            position: markerLatLng, 
            map: map 
          });
      //マーカーをクリックしたとき、詳細情報を表示
          let infowindow = new google.maps.InfoWindow({
            position: markerLatLng,
            content: "<a href='<%= store_url(store.id) %>' target='_blank'><%= store.title %></a>"
          }); //ここで詳細ページへのリンクを表示させる
          marker.addListener('click', function() {
            infowindow.open(map, marker);
          });

       })();
      <% end %>
      //複数マーカー ここまで  
      }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
  <style>
  #map {
    height: 600px;
    width: 600px;
  }
  </style>

  <div id="stores" class="min-w-full">

    <% @stores.each do |store| %>
    <%= link_to store.title, store_path(store) %>
      <% if current_user.liked?(store) %>
        <%= button_to 'UnLike', store_likes_path(store_id: store.id), method: :delete %>
      <% else %>
        <%= button_to 'Like', store_likes_path(store_id: store.id), method: :post %>
      <% end %>
    <% end %>
  </div>
</div>
